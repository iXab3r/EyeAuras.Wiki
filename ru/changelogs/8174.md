---
title: 1.6.8174
description: March - Major Macor/BT changes
published: true
date: 2025-03-25T19:40:02.072Z
tags: 
editor: markdown
dateCreated: 2025-03-25T18:43:31.007Z
---

# Major Macros changes
Значительно расширен функционал макросов и количество поддерживаемых операций. Практика показала, что деревья - довольно непростая в понимании вещь и Макросы всегда целили занять нишу между очень простыми аурами и совсем непростыми деревьями. Текущие изменения направлены не только на то, чтобы упрочнить их положение в этой нише, но и зацепить значительные части того хорошего, что есть как в Аурах, так и в Макросах. 

Ближе к делу:

## OnEnter WhileActive OnExit
Это основная идея и логика работы, которая была в Аурах. Что-то происходит - срабатывает Триггер. Дальше в ауре последовательно вызываются блоки 
- OnEnter - сразу же как только сработал триггер
- WhileActive - периодически вызывается до тех пор, пока триггер активен
- OnExit - вызывается только в тот момент, когда триггер выключился

С помощью этой комбинации блоков можно описать очень много различных ситуаций и автоматизировать геймплей, однако всегда не хватало гибкости - к примеру, в каких-то случаях хотелось бы иметь дополнительные условия в блоках или повторять действия несколько раз. Все это не заложено в ауры, однако является неотъемлимой частью Макросов.

Единственное, чего Макросам не хватало это какой-то возможности проверить текущее состояние Макроса, узнать, а должен ли он быть активен прямо в текущий момент. 

### Новая операция - CheckIsActive
И вот здесь-то как раз нам и приходит на помощь новая нода `CheckIsActive`, единственная работа которой - дать возможность из тела Макроса проверять текущее состояние активации. Одна эта нода позволяет в Макросе смоделировать ровно ту же логику, которая была всегда заложена в Ауры. 

Вариантов, как может выглядеть такой макрос очень много, вот всего лишь один из вариантов
![Aura-like macro](https://s3.eyeauras.net/media/2025/03/NVIDIA_Overlay_guhJJIXIeXTT6Pth.png)

Идея очень проста - у нас есть 3 блока команды. Первый(`OnEnter`) выполняется при входе. Второй блок(`WhileActive`) это на самом деле цикл `Repeat`, который выполняется, в нашем случае, каждые 250мс до тех пор, пока Макрос активен (условия соблюдены). Как только макрос будет деактивирован, цикл прекратится. И вот здесь-то наш третий блок, `OnExit`, получит управление и может сделать что-то завершающее.

В ближайшем будущем будет еще одна доработка, направленная на упрощение создания Aura-like Макросов.
Приведу еще один пример напоследок - вот так выглядит макрос, который дожидается деактивации и только под при выходе совершает какую-то операцию. По сути, это аналог ауры с `OnExit`

![OnExit](https://s3.eyeauras.net/media/2025/03/NVIDIA_Overlay_P5bH98ay2HsyUQYA.png)


## Портирование нод из Behavior Trees

Добавил поддержку целой пачки операций, которые ранее были доступны только в [Behavior Trees](/behavior-trees/gettings-started), но теперь доступны и в Макросах:
- [Selector](/behavior-trees/nodes/selector) 
- [Sequence](/behavior-trees/nodes/sequence) 
- [Cooldown](/behavior-trees/nodes/cooldown) 
- [Force Failure](/behavior-trees/nodes/force-failure) 
- [Force Success](/behavior-trees/nodes/force-success) 
- [Inverter](/behavior-trees/nodes/inverter) 
Обратите внимание, что первые 3 ноды (Selector/Sequence/Cooldown) чаще всего будут находить применение только как часть цикла `Repeat` - именно там они лучше всего раскрываются

## Пример ротации с помощью Макросов
Давайте посмотрим как можно построить ротацию из 2-ух скиллов и базовой атаки с помощью макросов:
![BT](https://s3.eyeauras.net/media/2025/03/NVIDIA_Overlay_OYrYJVqm0hGpTCCh.png)
Ничего особенного - проверяем кулдауны двух скиллов, затем проверяем, что скиллы доступны для кастования, далее кастуем их по очереди, а если скиллы не готовы - бьем базовой атакой.

Теперь давайте посмотрим на **ровно ту же логику**, но завернутую в макрос
![Macros](https://s3.eyeauras.net/media/2025/03/NVIDIA_Overlay_LK15f1AvUc404lPH.png)

Логика очень похожа, с той лишь разницей, что мы прямо в теле макроса сами создаем цикл, внутри которого у нас и будет часть с ротацией через [Selector](/behavior-trees/nodes/selector). 
p.s. глядя на этот скриншот кажется, что я переборщил с иконками и элементами форматирования - слишком "шумно", попробую что-нибудь с этим сделать.

Напоследок - в обозримом будущем макросы можно будет редактировать еще и в виде графа - этот функционал пока в процессе разработки, но такая форма отображения выглядит более простой для понимания во многих случаях.
![Graph](https://s3.eyeauras.net/media/2025/03/NVIDIA_Overlay_XPfbGXkMUFCLHrO4.png)


## Bugfixes/Improvements
- [BTs] Теперь макросы должны корректно прерываться, когда главное окно программы активировано


